var cov_2q5by82mta=function(){var path="/Users/adriaarki/bootcamp/collab/skylab-bootcamp-201907/staff/adria-arquimbau/KTBO/ktbo-api/logic/cart/add-to-cart/index.js";var hash="3ebb7ed986b932799a2d2ff330b3458847af469a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/adriaarki/bootcamp/collab/skylab-bootcamp-201907/staff/adria-arquimbau/KTBO/ktbo-api/logic/cart/add-to-cart/index.js",statementMap:{"0":{start:{line:1,column:51},end:{line:1,column:71}},"1":{start:{line:2,column:21},end:{line:2,column:42}},"2":{start:{line:16,column:0},end:{line:47,column:1}},"3":{start:{line:17,column:4},end:{line:17,column:31}},"4":{start:{line:18,column:4},end:{line:18,column:37}},"5":{start:{line:19,column:4},end:{line:19,column:43}},"6":{start:{line:20,column:4},end:{line:20,column:41}},"7":{start:{line:22,column:4},end:{line:46,column:8}},"8":{start:{line:23,column:21},end:{line:23,column:48}},"9":{start:{line:25,column:8},end:{line:25,column:71}},"10":{start:{line:25,column:19},end:{line:25,column:71}},"11":{start:{line:27,column:24},end:{line:27,column:57}},"12":{start:{line:29,column:8},end:{line:29,column:91}},"13":{start:{line:29,column:40},end:{line:29,column:91}},"14":{start:{line:31,column:19},end:{line:31,column:80}},"15":{start:{line:31,column:42},end:{line:31,column:79}},"16":{start:{line:33,column:8},end:{line:33,column:99}},"17":{start:{line:35,column:8},end:{line:35,column:25}},"18":{start:{line:37,column:22},end:{line:37,column:49}},"19":{start:{line:39,column:20},end:{line:39,column:82}},"20":{start:{line:39,column:44},end:{line:39,column:81}},"21":{start:{line:41,column:8},end:{line:41,column:45}},"22":{start:{line:41,column:29},end:{line:41,column:45}},"23":{start:{line:43,column:8},end:{line:43,column:26}},"24":{start:{line:45,column:8},end:{line:45,column:25}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:16,column:17},end:{line:16,column:18}},loc:{start:{line:16,column:55},end:{line:47,column:1}},line:16},"1":{name:"(anonymous_1)",decl:{start:{line:22,column:12},end:{line:22,column:13}},loc:{start:{line:22,column:24},end:{line:46,column:5}},line:22},"2":{name:"(anonymous_2)",decl:{start:{line:31,column:34},end:{line:31,column:35}},loc:{start:{line:31,column:42},end:{line:31,column:79}},line:31},"3":{name:"(anonymous_3)",decl:{start:{line:39,column:36},end:{line:39,column:37}},loc:{start:{line:39,column:44},end:{line:39,column:81}},line:39}},branchMap:{"0":{loc:{start:{line:25,column:8},end:{line:25,column:71}},type:"if",locations:[{start:{line:25,column:8},end:{line:25,column:71}},{start:{line:25,column:8},end:{line:25,column:71}}],line:25},"1":{loc:{start:{line:29,column:8},end:{line:29,column:91}},type:"if",locations:[{start:{line:29,column:8},end:{line:29,column:91}},{start:{line:29,column:8},end:{line:29,column:91}}],line:29},"2":{loc:{start:{line:33,column:8},end:{line:33,column:99}},type:"cond-expr",locations:[{start:{line:33,column:15},end:{line:33,column:40}},{start:{line:33,column:43},end:{line:33,column:99}}],line:33},"3":{loc:{start:{line:41,column:8},end:{line:41,column:45}},type:"if",locations:[{start:{line:41,column:8},end:{line:41,column:45}},{start:{line:41,column:8},end:{line:41,column:45}}],line:41}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"3ebb7ed986b932799a2d2ff330b3458847af469a"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();const{models:{Article,User,Order,Item}}=(cov_2q5by82mta.s[0]++,require('ktbo-data'));const{validate}=(cov_2q5by82mta.s[1]++,require('ktbo-utils'));/**
 * 
 * @param {*} ref 
 * @param {*} title 
 * @param {*} description 
 * @param {*} img 
 * @param {*} quantity 
 * @param {*} category 
 * 
 * @returns {Promise}
 */cov_2q5by82mta.s[2]++;module.exports=function(userId,articleId,quantity){cov_2q5by82mta.f[0]++;cov_2q5by82mta.s[3]++;quantity=Number(quantity);cov_2q5by82mta.s[4]++;validate.string(userId,'userId');cov_2q5by82mta.s[5]++;validate.string(articleId,'articleId');cov_2q5by82mta.s[6]++;validate.number(quantity,'quantity');cov_2q5by82mta.s[7]++;return(async()=>{cov_2q5by82mta.f[1]++;const user=(cov_2q5by82mta.s[8]++,await User.findById(userId));cov_2q5by82mta.s[9]++;if(!user){cov_2q5by82mta.b[0][0]++;cov_2q5by82mta.s[10]++;throw Error(`User with id ${userId} does not exist`);}else{cov_2q5by82mta.b[0][1]++;}const article=(cov_2q5by82mta.s[11]++,await Article.findById(articleId));cov_2q5by82mta.s[12]++;if(article.quantity<quantity){cov_2q5by82mta.b[1][0]++;cov_2q5by82mta.s[13]++;throw Error('Stock greater than quantity required');}else{cov_2q5by82mta.b[1][1]++;}let item=(cov_2q5by82mta.s[14]++,user.cart.find(item=>{cov_2q5by82mta.f[2]++;cov_2q5by82mta.s[15]++;return item.article.toString()===articleId;}));cov_2q5by82mta.s[16]++;item?(cov_2q5by82mta.b[2][0]++,item.quantity+=quantity):(cov_2q5by82mta.b[2][1]++,user.cart.push(new Item({article:articleId,quantity})));cov_2q5by82mta.s[17]++;await user.save();const user1=(cov_2q5by82mta.s[18]++,await User.findById(userId));let item1=(cov_2q5by82mta.s[19]++,user1.cart.find(item=>{cov_2q5by82mta.f[3]++;cov_2q5by82mta.s[20]++;return item.article.toString()===articleId;}));cov_2q5by82mta.s[21]++;if(item1.quantity<0){cov_2q5by82mta.b[3][0]++;cov_2q5by82mta.s[22]++;item1.quantity=0;}else{cov_2q5by82mta.b[3][1]++;}cov_2q5by82mta.s[23]++;await user1.save();cov_2q5by82mta.s[24]++;return user1.cart;})();};